{
  "rules": {
    "rules_version": "2",
    "service cloud.firestore": {
      "match /databases/{database}/documents": {
        "// User documents - only owner can read/write": {},
        "match /users/{userId}": {
          "allow read, write": "if request.auth != null && request.auth.uid == userId",
          
          "// Trade subcollection": {},
          "match /trades/{tradeId}": {
            "allow read, write": "if request.auth != null && request.auth.uid == userId"
          },
          
          "// Strategies subcollection": {},
          "match /strategies/{strategyId}": {
            "allow read, write": "if request.auth != null && request.auth.uid == userId"
          },
          
          "// Analytics subcollection": {},
          "match /analytics/{period}": {
            "allow read, write": "if request.auth != null && request.auth.uid == userId"
          }
        }
      }
    }
  },
  "indexes": [
    {
      "collectionGroup": "trades",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "exitDate", "order": "DESCENDING" }
      ]
    },
    {
      "collectionGroup": "trades",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "strategy", "order": "ASCENDING" },
        { "fieldPath": "exitDate", "order": "DESCENDING" }
      ]
    },
    {
      "collectionGroup": "trades",
      "queryScope": "COLLECTION",
      "fields": [
        { "fieldPath": "symbol", "order": "ASCENDING" },
        { "fieldPath": "exitDate", "order": "DESCENDING" }
      ]
    }
  ]
}
